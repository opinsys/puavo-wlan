#!/bin/bash

set -eu

source puavo-wlanap-dnsproxy-env
source "${PWAP_DATADIR}/config"
source "${PWAP_CONFDIR}/config" || true

networkcache="${PWAP_DNSPROXY_STATEDIR}/networkcache"
touch "${networkcache}"
flock "${networkcache}" -c "sort -u <(cat '${networkcache}') <(echo $2) >'${networkcache}'"
echo "vtun-up $2" | nc -U "${PWAP_DNSPROXY_RUNDIR}/control.socket"
