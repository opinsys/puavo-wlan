#!/bin/sh

. /etc/puavo-wlanap/config

puavo-wlanap-update-configs

if [ $? -eq 1 ]
then
    exit 0
fi

if [ $? -gt 1 ]
then
    exit $?
fi

vtund -n -f /var/tmp/puavo-wlanap/vtund.conf wlan $server_ip&
hostapd -P /var/tmp/puavo-wlanap/hostapd.pid /var/tmp/puavo-wlanap/hostapd.conf&

if [ $? -ne 0 ]
then
    echo "error: failed to initialize tunnels" >&2
    exit 1
fi

while true
do
    sleep 300
    puavo-wlanap-send-status
done

