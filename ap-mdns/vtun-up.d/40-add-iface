#!/bin/bash

set -eu

source puavo-wlanap-mdns-env
source "${PWAP_MDNS_DATADIR}/config"
source "${PWAP_MDNS_CONFDIR}/config" || true

networkcache="${PWAP_MDNS_STATEDIR}/networkcache"
touch "${networkcache}"
flock "${networkcache}" -c "sort -u <(cat '${networkcache}') <(echo $2) >'${networkcache}'"
echo "vtun-up $2" | nc -U "${PWAP_MDNS_RUNDIR}/control.socket"
