#!/bin/bash

set -eu

if [ $# -ne 2 ]; then
    echo "$(basename $0): wrong number of arguments ($#)" >&2
    echo "Usage: $(basename $0) IFACE CHANNEL" >&2
    exit 1
fi

iface=$1
channel=$2

## Check if the radio is capable of using 20MHz channels with Short
## Guard Intervals.
is_ht20sgi_capab=true
read phyname <"/sys/class/net/${iface}/phy80211/name"
egrep -q '^\s+RX HT20 SGI$' < <(iw "${phyname}" info) || is_ht20sgi_capab=false

case "${channel}" in
    1|6)
        if $is_ht20sgi_capab; then
            printf -v ht_capab '%s' "[HT20][SHORT-GI-20]"
        else
            printf -v ht_capab '%s' "[HT40+]"
        fi
        ;;
    36|44)
        printf -v ht_capab '%s' "[HT40+]"
        ;;
    11)
        if $is_ht20sgi_capab; then
            printf -v  ht_capab '%s' "[HT20][SHORT-GI-20]"
        else
            printf -v ht_capab '%s' "[HT40-]"
        fi
        ;;
    40|48)
        printf -v ht_capab '%s' "[HT40-]"
        ;;
    *)
        printf 'bad channel %d\' ${channel} >&2
        exit 1
        ;;
esac

printf '%s' ${ht_capab}
